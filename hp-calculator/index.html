<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ガチャポイント計算機</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles */
        body {
            font-family: "Inter", sans-serif;
            background-color: #f0f4f8; /* Light background */
        }

        /* Toggle Switch Styles */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px; /* 幅 */
            height: 24px; /* 高さ */
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc; /* オフ時の背景色 */
            transition: .4s;
            border-radius: 24px; /* 角丸 */
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px; /* 丸の高さ */
            width: 16px; /* 丸の幅 */
            left: 4px; /* 左からの位置 */
            bottom: 4px; /* 下からの位置 */
            background-color: white; /* 丸の色 */
            transition: .4s;
            border-radius: 50%; /* 真円 */
        }

        input:checked + .slider {
            background-color: #4169e1; /* オン時の背景色 */
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #4169e1;
        }

        input:checked + .slider:before {
            transform: translateX(16px); /* 右に移動 */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md">
        <h1 class="text-2xl font-bold text-center mb-6 text-gray-800">ガチャポイント計算機</h1>

        <div class="space-y-4">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">初期所持の槌</h2>
            <div class="flex items-center justify-between">
                <label class="text-gray-700">木槌：</label>
                <input type="number" id="initialWoodenHammer" min="0" class="w-24 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:border-blue-300">
            </div>

            <div class="flex items-center justify-between">
                <label class="text-gray-700">鉄槌：</label>
                <input type="number" id="initialIronHammer" min="0" class="w-24 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:border-blue-300">
            </div>

            <div class="flex items-center justify-between">
                <label class="text-gray-700">銅槌：</label>
                <input type="number" id="initialCopperHammer" min="0" class="w-24 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:border-blue-300">
            </div>

            <div class="flex items-center justify-between">
                <label class="text-gray-700">銀槌：</label>
                <input type="number" id="initialSilverHammer" min="0" class="w-24 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:border-blue-300">
            </div>

            <div class="flex items-center justify-between">
                <label class="text-gray-700">金槌：</label>
                <input type="number" id="initialGoldHammer" min="0" class="w-24 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:border-blue-300">
            </div>
        </div>

        <div class="mt-4 flex items-center justify-between">
            <label class="text-gray-700">週間イベントモード (β):</label>
            <label class="toggle-switch">
                <input type="checkbox" id="addIronHammerToggle">
                <span class="slider"></span>
            </label>
        </div>


        <button id="calculateFinalBtn" class="mt-6 w-full bg-[#4169e1] text-white py-2 px-4 rounded-md hover:bg-[#3a5da8] focus:outline-none focus:ring focus:ring-blue-300 transition duration-200 ease-in-out">
            ポイント計算
        </button>

        <div class="mt-6 text-center text-lg font-semibold text-gray-800">
            最終獲得ポイント：<span id="finalTotalPoints">0</span> Pt
        </div>

        <div class="mt-4 text-sm text-gray-600">
            <h3 class="font-semibold">獲得した槌の内訳：</h3>
            <p>木槌：<span id="gainedWooden">0</span>　鉄槌：<span id="gainedIron">0</span>　銅槌：<span id="gainedCopper">0</span>　銀槌：<span id="gainedSilver">0</span>　金槌：<span id="gainedGold">0</span></p>
        </div>
    </div>

    <script>
        // Get references to the input fields and result display
        const initialWoodenHammerInput = document.getElementById('initialWoodenHammer');
        const initialIronHammerInput = document.getElementById('initialIronHammer');
        const initialCopperHammerInput = document.getElementById('initialCopperHammer');
        const initialSilverHammerInput = document.getElementById('initialSilverHammer');
        const initialGoldHammerInput = document.getElementById('initialGoldHammer');
        const addIronHammerToggle = document.getElementById('addIronHammerToggle'); // 切り替えボタンの参照を取得
        const calculateFinalBtn = document.getElementById('calculateFinalBtn');
        const finalTotalPointsSpan = document.getElementById('finalTotalPoints');

        // Get references for gained hammers breakdown
        const gainedWoodenSpan = document.getElementById('gainedWooden');
        const gainedIronSpan = document.getElementById('gainedIron');
        const gainedCopperSpan = document.getElementById('gainedCopper');
        const gainedSilverSpan = document.getElementById('gainedSilver');
        const gainedGoldSpan = document.getElementById('gainedGold');

        // Define the point values for each hammer type
        const pointsPerHammer = {
            wooden: 1,
            iron: 10,
            copper: 20,
            silver: 50,
            gold: 0 // 金槌は0ポイント
        };

        // Define the points required to gain hammers and the hammer gained
        // threshold_diff: 前回の閾値からの差分ポイント
        // hammer: 獲得できる槌の種類
        const gainThresholds = [
            { threshold_diff: 10, hammer: 'iron' },   // 10Pt獲得で鉄槌
            { threshold_diff: 20, hammer: 'iron' },   // さらに20Pt獲得で鉄槌 (累計30Pt)
            { threshold_diff: 30, hammer: 'copper' }, // さらに30Pt獲得で銅槌 (累計60Pt)
            { threshold_diff: 40, hammer: 'silver' }, // さらに40Pt獲得で銀槌 (累計100Pt)
            { threshold_diff: 80, hammer: 'silver' }, // さらに80Pt獲得で銀槌 (累計180Pt)
            { threshold_diff: 100, hammer: 'silver' }, // さらに100Pt獲得で銀槌 (累計280Pt)
            { threshold_diff: 70, hammer: 'copper' }, // さらに70Pt獲得で銅槌 (累計350Pt)
            { threshold_diff: 50, hammer: 'silver' }, // さらに50Pt獲得で銀槌 (累計400Pt)
            { threshold_diff: 100, hammer: 'gold' }   // さらに100Pt獲得で金槌 (累計500Pt)
        ];

        /**
         * Calculates the total points from a given set of hammers.
         * @param {object} hammers - An object containing the count of each hammer type.
         * @returns {number} The total points.
         */
        function calculatePointsFromHammers(hammers) {
            let total = 0;
            total += (hammers.wooden || 0) * pointsPerHammer.wooden;
            total += (hammers.iron || 0) * pointsPerHammer.iron;
            total += (hammers.copper || 0) * pointsPerHammer.copper;
            total += (hammers.silver || 0) * pointsPerHammer.silver;
            total += (hammers.gold || 0) * pointsPerHammer.gold;
            return total;
        }

        // Add event listener to the button
        calculateFinalBtn.addEventListener('click', () => {
            // Get the initial number of each hammer
            let hammersForProcessing = {
                wooden: parseInt(initialWoodenHammerInput.value) || 0,
                iron: parseInt(initialIronHammerInput.value) || 0,
                copper: parseInt(initialCopperHammerInput.value) || 0,
                silver: parseInt(initialSilverHammerInput.value) || 0,
                gold: parseInt(initialGoldHammerInput.value) || 0
            };

            // 切り替えボタンがオンの場合、鉄槌に190を加算
            if (addIronHammerToggle.checked) {
                hammersForProcessing.iron += 190;
            }

            let totalPointsEarned = 0;
            let pointsAccumulatedSinceLastThreshold = 0; // 最後に閾値を達成してから蓄積されたポイント
            let currentThresholdIndex = 0; // 現在チェックしている閾値のインデックス (0からgainThresholds.length-1)
            const totalGainedHammers = { wooden: 0, iron: 0, copper: 0, silver: 0, gold: 0 };

            // Iterative calculation loop
            // ループは、処理すべきハンマーが残っているか、または獲得したポイントで新たな閾値を超えられる限り続きます。
            let iterationCount = 0;
            const maxIterations = 1000; // 無限ループ防止のための最大試行回数 (必要に応じて調整)

            while (iterationCount < maxIterations) {
                // このイテレーションで処理するハンマーからポイントを計算
                const pointsFromCurrentHammers = calculatePointsFromHammers(hammersForProcessing);

                // 処理すべきハンマーがなく、かつ蓄積ポイントが次の閾値に満たない場合はループ終了
                if (pointsFromCurrentHammers === 0 && (currentThresholdIndex >= gainThresholds.length || pointsAccumulatedSinceLastThreshold < gainThresholds[currentThresholdIndex].threshold_diff)) {
                     break;
                }

                // 獲得したポイントを累計ポイントに加算
                totalPointsEarned += pointsFromCurrentHammers;
                // 獲得したポイントを蓄積ポイントに加算
                pointsAccumulatedSinceLastThreshold += pointsFromCurrentHammers;

                // 処理したハンマーをリセット（消費されたとみなす）
                hammersForProcessing = { wooden: 0, iron: 0, copper: 0, silver: 0, gold: 0 };

                // 蓄積ポイントで達成できる閾値をチェックし、槌を獲得
                // 蓄積ポイントが現在の閾値差分以上であれば、獲得を繰り返す
                let gainedHammerThisIteration = false; // このイテレーションで槌を獲得したかどうかのフラグ
                while (currentThresholdIndex < gainThresholds.length && pointsAccumulatedSinceLastThreshold >= gainThresholds[currentThresholdIndex].threshold_diff) {
                    const hammerTypeToGain = gainThresholds[currentThresholdIndex].hammer;

                    // 獲得した槌を totalGainedHammers に加算 (最終的な内訳用)
                    totalGainedHammers[hammerTypeToGain]++;
                    // 獲得した槌を次のイテレーションで処理するハンマーリストに加算
                    hammersForProcessing[hammerTypeToGain]++;
                    gainedHammerThisIteration = true; // 槌を獲得したことを記録

                    // 獲得に使用したポイントを蓄積ポイントから減算
                    pointsAccumulatedSinceLastThreshold -= gainThresholds[currentThresholdIndex].threshold_diff;

                    // 次の閾値インデックスに進む
                    if (currentThresholdIndex < gainThresholds.length) { // 閾値リストの範囲内かチェック
                         currentThresholdIndex++;
                    }


                    // 閾値リストの最後に達したら、最初の閾値に戻る（ループ）
                    if (currentThresholdIndex >= gainThresholds.length) {
                        currentThresholdIndex = 0;
                        // 蓄積ポイントの残りはそのまま次のサイクルの開始ポイントとなる
                    }
                }

                iterationCount++;
            }

            if (iterationCount >= maxIterations) {
                console.warn("最大試行回数に達しました。計算が収束しない可能性があります。");
                // 無限ループの可能性を示唆する場合、ユーザーに通知するなどの処理を追加することもできます。
            }

            // 最終的な累計ポイントを表示
            finalTotalPointsSpan.textContent = totalPointsEarned;

            // 獲得した槌の内訳を表示
            gainedWoodenSpan.textContent = totalGainedHammers.wooden;
            gainedIronSpan.textContent = totalGainedHammers.iron;
            gainedCopperSpan.textContent = totalGainedHammers.copper;
            gainedSilverSpan.textContent = totalGainedHammers.silver;
            gainedGoldSpan.textContent = totalGainedHammers.gold;
        });
    </script>
</body>
</html>
