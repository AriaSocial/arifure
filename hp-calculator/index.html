<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ガチャポイント計算機</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles if needed */
        body {
            font-family: "Inter", sans-serif;
            background-color: #f0f4f8; /* Light background */
        }
        /* Custom background color for the button */
        .bg-royal-blue {
            background-color: #4169e1; /* Royal Blue */
        }
        .hover\:bg-darker-royal-blue:hover {
            background-color: #3557b1; /* Slightly darker Royal Blue on hover */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md">
        <h1 class="text-2xl font-bold text-center mb-6 text-gray-800">ガチャポイント計算機</h1>

        <div class="space-y-4">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">初期所持の槌</h2>
            <div class="flex items-center justify-between">
                <label for="initialWoodenHammer" class="text-gray-700">木槌：</label>
                <input type="number" id="initialWoodenHammer" value="0" min="0" class="w-24 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:border-blue-300">
            </div>

            <div class="flex items-center justify-between">
                <label for="initialIronHammer" class="text-gray-700">鉄槌：</label>
                <input type="number" id="initialIronHammer" value="0" min="0" class="w-24 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:border-blue-300">
            </div>

            <div class="flex items-center justify-between">
                <label for="initialCopperHammer" class="text-gray-700">銅槌：</label>
                <input type="number" id="initialCopperHammer" value="0" min="0" class="w-24 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:border-blue-300">
            </div>

            <div class="flex items-center justify-between">
                <label for="initialSilverHammer" class="text-gray-700">銀槌：</label>
                <input type="number" id="initialSilverHammer" value="0" min="0" class="w-24 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:border-blue-300">
            </div>

            <div class="flex items-center justify-between">
                <label for="initialGoldHammer" class="text-gray-700">金槌：</label>
                <input type="number" id="initialGoldHammer" value="0" min="0" class="w-24 p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:border-blue-300">
            </div>
        </div>

        <button id="calculateFinalBtn" class="mt-6 w-full bg-royal-blue hover:bg-darker-royal-blue text-white py-2 px-4 rounded-md focus:outline-none focus:ring focus:ring-blue-300 transition duration-200 ease-in-out">
            ポイント計算
        </button>

        <div class="mt-6 text-center text-lg font-semibold text-gray-800">
            最終獲得ポイント：<span id="finalTotalPoints">0</span> Pt
        </div>

        <div class="mt-4 text-sm text-gray-600">
            <h3 class="font-semibold">獲得した槌の内訳：</h3>
            <p>木槌：<span id="gainedWooden">0</span>　鉄槌：<span id="gainedIron">0</span>　銅槌：<span id="gainedCopper">0</span>　銀槌：<span id="gainedSilver">0</span>　金槌：<span id="gainedGold">0</span></p>
        </div>
    </div>

    <script>
        // Get references to the input fields and result display
        const initialWoodenHammerInput = document.getElementById('initialWoodenHammer');
        const initialIronHammerInput = document.getElementById('initialIronHammer');
        const initialCopperHammerInput = document.getElementById('initialCopperHammer');
        const initialSilverHammerInput = document.getElementById('initialSilverHammer');
        const initialGoldHammerInput = document.getElementById('initialGoldHammer');
        const calculateFinalBtn = document.getElementById('calculateFinalBtn');
        const finalTotalPointsSpan = document.getElementById('finalTotalPoints');

        // Get references for gained hammers breakdown
        const gainedWoodenSpan = document.getElementById('gainedWooden');
        const gainedIronSpan = document.getElementById('gainedIron');
        const gainedCopperSpan = document.getElementById('gainedCopper');
        const gainedSilverSpan = document.getElementById('gainedSilver');
        const gainedGoldSpan = document.getElementById('gainedGold');

        // Define the point values for each hammer type
        const pointsPerHammer = {
            wooden: 1,
            iron: 10,
            copper: 20,
            silver: 50,
            gold: 0 // 金槌は0ポイント
        };

        // Define the points required to gain hammers and the hammer gained
        // cumulative_threshold: 槌を獲得するために必要な累計ポイント
        // hammer: 獲得できる槌の種類
        const gainThresholds = [
            { cumulative_threshold: 10, hammer: 'iron' },   // 累計10Pt獲得で鉄槌
            { cumulative_threshold: 30, hammer: 'iron' },   // 累計30Pt獲得で鉄槌
            { cumulative_threshold: 60, hammer: 'copper' }, // 累計60Pt獲得で銅槌
            { cumulative_threshold: 100, hammer: 'silver' }, // 累計100Pt獲得で銀槌
            { cumulative_threshold: 180, hammer: 'silver' }, // 累計180Pt獲得で銀槌
            { cumulative_threshold: 280, hammer: 'silver' }, // 累計280Pt獲得で銀槌
            { cumulative_threshold: 350, hammer: 'copper' }, // 累計350Pt獲得で銅槌
            { cumulative_threshold: 400, hammer: 'silver' }, // 累計400Pt獲得で銀槌
            { cumulative_threshold: 500, hammer: 'gold' }   // 累計500Pt獲得で金槌
        ];

        /**
         * Calculates the total points from a given set of hammers.
         * @param {object} hammers - An object containing the count of each hammer type.
         * @returns {number} The total points.
         */
        function calculatePointsFromHammers(hammers) {
            let total = 0;
            total += (hammers.wooden || 0) * pointsPerHammer.wooden;
            total += (hammers.iron || 0) * pointsPerHammer.iron;
            total += (hammers.copper || 0) * pointsPerHammer.copper;
            total += (hammers.silver || 0) * pointsPerHammer.silver;
            total += (hammers.gold || 0) * pointsPerHammer.gold;
            return total;
        }

        // Add event listener to the button
        calculateFinalBtn.addEventListener('click', () => {
            // Get the initial number of each hammer
            let currentHammers = {
                wooden: parseInt(initialWoodenHammerInput.value) || 0,
                iron: parseInt(initialIronHammerInput.value) || 0,
                copper: parseInt(initialCopperHammerInput.value) || 0,
                silver: parseInt(initialSilverHammerInput.value) || 0,
                gold: parseInt(initialGoldHammerInput.value) || 0
            };

            let totalPointsEarned = 0;
            const totalGainedHammers = { wooden: 0, iron: 0, copper: 0, silver: 0, gold: 0 };
            let currentThresholdIndex = 0; // 現在チェックしている累計閾値のインデックス

            let iterationCount = 0;
            const maxIterations = 1000; // 無限ループ防止のための最大試行回数 (閾値の数に応じて調整)

            // Iterative calculation loop
            // 処理すべきハンマーが残っている限り、または新たな槌を獲得できる限りループを続けます。
            while (iterationCount < maxIterations) {
                let pointsFromCurrentHammers = calculatePointsFromHammers(currentHammers);

                // 今回のイテレーションで処理したハンマーをリセット（消費されたとみなす）
                currentHammers = { wooden: 0, iron: 0, copper: 0, silver: 0, gold: 0 };

                // 獲得したポイントを累計ポイントに加算
                totalPointsEarned += pointsFromCurrentHammers;

                let gainedAnyHammerThisIteration = false; // このイテレーションで槌を獲得したかどうかのフラグ

                // 累計ポイントで達成できる閾値をチェックし、槌を獲得
                while (currentThresholdIndex < gainThresholds.length && totalPointsEarned >= gainThresholds[currentThresholdIndex].cumulative_threshold) {
                    const hammerTypeToGain = gainThresholds[currentThresholdIndex].hammer;

                    // 獲得した槌を totalGainedHammers に加算 (最終的な内訳用)
                    totalGainedHammers[hammerTypeToGain]++;
                    // 獲得した槌を次のイテレーションで処理するハンマーリストに加算
                    currentHammers[hammerTypeToGain]++;
                    gainedAnyHammerThisIteration = true; // 槌を獲得したことを記録

                    // 次の閾値インデックスに進む
                    currentThresholdIndex++;
                }

                // このイテレーションで新たな槌を獲得せず、かつ、処理すべきハンマーも残っていない場合、ループを終了
                // pointsFromCurrentHammers === 0 は、このイテレーションの開始時点で処理すべきハンマーがなかったことを意味します。
                // gainedAnyHammerThisIteration === false は、このイテレーションで獲得したポイントによって新たな槌が得られなかったことを意味します。
                if (pointsFromCurrentHammers === 0 && !gainedAnyHammerThisIteration) {
                    break;
                }

                iterationCount++;
            }

            if (iterationCount >= maxIterations) {
                console.warn("最大試行回数に達しました。計算が収束しない可能性があります。");
                // 無限ループの可能性を示唆する場合、ユーザーに通知するなどの処理を追加することもできます。
            }


            // 最終的な累計ポイントを表示
            finalTotalPointsSpan.textContent = totalPointsEarned;

            // 獲得した槌の内訳を表示
            gainedWoodenSpan.textContent = totalGainedHammers.wooden;
            gainedIronSpan.textContent = totalGainedHammers.iron;
            gainedCopperSpan.textContent = totalGainedHammers.copper;
            gainedSilverSpan.textContent = totalGainedHammers.silver;
            gainedGoldSpan.textContent = totalGainedHammers.gold;
        });
    </script>
</body>
</html>
